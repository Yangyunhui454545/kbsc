<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <!-- ì¹´í…Œê³ ë¦¬ í˜ì´ì§€ì—ì„œ ìƒí’ˆì„ ì„ íƒí–ˆì„ ë•Œ í‘œì‹œë˜ëŠ” ìƒí’ˆ í˜ì´ì§€ -->
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìƒí’ˆ</title>
  <link rel="stylesheet" href="/css/reset.css">
  <link rel="stylesheet" href="/css/item.css">
</head>
<body>
<div id="wrap">
  <header>
    <div class="title-container">
      <button class="go-prev">&lt;</button>
      <h1 class="title">ìƒí’ˆ</h1>
    </div>
    <div class="top-button-container">
      <button class="go-cart" title="https://www.freepik.com"></button>
    </div>
  </header>
  <div class="img-container">
    <p class="vegan-p"></p>
    <img class="item-img">
  </div>
  <div class="info-container">
    <h3 class="item-title"></h3>
    <div class="price-container">
      <p
              class="origin-price"
      ></p>
      <p class="discount-price"></p>
    </div>
    <div class="rate-container">
      <span class="review-rate" id="review-rate-text"></span>
      <span class="review-rate review"></span>
    </div>
  </div>
  <footer>
    <p class="go-info">ìƒí’ˆ ìƒì„¸ ì„¤ëª… ë³´ê¸°</p>
  </footer>
</div>
<script src="/js/createBtnContainer.js"></script>
<script>
  const url = location.pathname.split('/')[2];
  fetch(`/dev/item/${url}`)
          .then(res => res.text())
          .then(data => {
            console.log(data);
            data = JSON.parse(data);

            const item_id = data.Item.itemId;
            const item_isTestable = data.Item.itemTestable;
            // ì¶”ê°€í•´ë‹¬ë¼ê³  ìš”ì²­í•´ì•¼í•¨ const review_rate;  // ì¶”ê°€ í›„ ìˆ˜ì •í•„ìš”í•œë¶€ë¶„
            const item_name = data.Item.itemName;
            const item_price = data.Item.itemPrice;
            const item_discountPrice = data.Item.itemDiscountPrice;
            const item_img = data.Item.itemImage;
            console.log(item_img);

            const imgContainer = document.querySelector('.img-container');
            const img_src = document.querySelector('.item-img');
            img_src.src = item_img;

            if (data.Item.isVegan === 'Y') {
              const veganP = document.querySelector('.vegan-p');
              veganP.textContent = 'ğŸŒ± í™˜ê²½ì„ ì§€í‚¤ëŠ” ë¹„ê±´ìƒí’ˆ ğŸŒ±';
              const veganIcon = document.createElement('div');
              veganIcon.classList.add('vegan-icon');
              const veganImg = document.createElement('img');
              veganImg.classList.add('vegan-img');
              veganImg.src = '/img/green-tea.png';
              veganIcon.appendChild(veganImg);
              imgContainer.appendChild(veganIcon);
            }

            const title = document.querySelector('.item-title');
            title.textContent = item_name;

            if(item_price != item_discountPrice){
              document.querySelector('.origin-price').textContent = `${item_price} ì›`;
            }
            document.querySelector('.discount-price').textContent = `${item_discountPrice} ì›`;



            localStorage.setItem('c_item_id',item_id);
            localStorage.setItem('c_item_name',item_name);
            localStorage.setItem('c_item_isTestable',item_isTestable);



            const footer = document.querySelector('footer');
            footer.addEventListener('click', () => location.href = `/item/${item_id}/detail`);

            const getItemInfoElList = (item_id, item_isTestable) => {
              const btnContainer = document.createElement('div');
              btnContainer.classList += 'btn-container';
              createBtnContainer(item_id, item_isTestable).forEach(el =>
                      btnContainer.appendChild(el));

              return btnContainer;
            }

            const infoContainer = document.querySelector('.info-container');
            infoContainer.appendChild(getItemInfoElList(item_id, item_isTestable));
          })

  fetch(`/dev/item/${url}/reviewCnt`)
          .then(res => res.text())
          .then(data => {
            console.log(data);
            r_data = JSON.parse(data);

            const review_count = r_data.size;
            const review_rate = r_data.rate;
            // ì¶”ê°€ í›„ ìˆ˜ì •í•„ìš”í•œë¶€ë¶„
            document.querySelector('#review-rate-text').textContent = `â­${review_count}  `;
            // ì¶”ê°€ í›„ ìˆ˜ì •í•„ìš”í•œë¶€ë¶„
            const reviewSpan = document.querySelector('.review');
            reviewSpan.textContent = (review_rate === 'NaN') ? `(0)` : `(${review_rate.toFixed(1)})`;
          })

</script>
<script src="/js/item.js"></script>
</body>
</html>